#!/bin/sh

pac="$(checkupdates)"
aur="$(aur repo -u)"
vcs="$(aur vercmp-devel)"

pac_n=$(printf "$pac" | grep -c '^')
aur_n=$(printf "$aur" | grep -c '^')
vcs_n=$(printf "$vcs" | grep -c '^')

text="$pac_n/$aur_n/$vcs_n"
tooltip=""
[ -n "$pac" ] && tooltip="${tooltip}PKG:\n\n$pac\n\n"
[ -n "$aur" ] && tooltip="${tooltip}AUR:\n\n$aur\n\n"
[ -n "$vcs" ] && tooltip="${tooltip}VCS:\n\n$vcs\n\n"

tooltip="$(printf "$tooltip" | perl -pe 's/\n/\\n/g' | perl -pe 's/(?:\\n)+$//')"

if [ "$text" = "0/0/0" ]; then
    printf '{"text": ""}\n'
else
    printf '{"text": "ï’ž %s", "tooltip": "%s" }\n' "$text" "$tooltip"
fi
